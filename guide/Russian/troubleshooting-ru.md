<img align="right" src="https://github.com/woacepheus/Port-Windows-11-Xiaomi-Mi-9/blob/main/cepheus.png" width="425">


# Windows на Xiaomi Mi 9

## Решение возможных проблем


## Устройство запускается в Android, но не запускается в загрузчик

### Требования:

- [ADB и Fastboot](https://developer.android.com/studio/releases/platform-tools)

> [!WARNING]
> Возможно, эти шаги не помогут потому на что Xiaomi Pad 5 нет полностью рабочего рекавери для установки. Также как и у большинства современных A/B устройств у нас нет установщика TWRP из-за изменённого загрузчика. Если у вас установлена AOSP прошивка, возможно она содержит предустановленное AOSP рекавери. Вы можете использовать его для шагов ниже. Если у вас установлена MIUI без Root-доступа, эти шаги вам не помогут.
>
> Также, пожалуйста, избегайте имён разделов, которые содержат пробелы и специальные символы, и, если это возможно, используйте имена `ESPNABU` и `WINNABU`, которые проверены уже сотни раз. Если вы испортите загрузчик запрещёнными выше именами разделов и у вас MIUI без Root-доступа, вам необходимо прошить прошивку в режиме EDL с авторизованным аккаунтом, что может привести к денежным тратам.


Ошибка связана с тем, что загрузчик не может обработать имена разделов. Чтобы это исправить:

- Запустите рекавери

- Подключите планшет к ПК

- На компьютере откройте командную строку

- Выполните ```adb shell```

- Выполните ```parted```

- Выполните ```print``` чтобы получить список разделов

- Найдите разделы, содержащие пробелы или специальные символы, например "Basic Data Partition" и запомните их номера

- Теперь выполните ```rm <vol number>```, например ```rm 99```


## BSOD ошибка "fsa4480.sys" при загрузке

- Откройте на компьютере папку с драйверами

- Удалите папку ```components\QC8150\Device\DEVICE.SOC_QC8150.NABU\Drivers\USB```

- Переустановите драйверы

- Запустите UEFI

- После запуска верните папку с драйвером и переустановите драйверы снова


## Как восстановить работу USB (в т.ч. зарядки)

> [!WARNING]
> Чтобы зарядка работала, необходимо подключить зарядное устройство до загрузки Windows. Если отключить кабель после запуска системы, то планшет не будет заряжаться до перезапуска.


> [!NOTE]
> Протестировано с TypeC-TypeC зарядкой с поддержкой PowerDelivery, зарядка Xiaomi 33Вт также работает.

- Установите этот образ UEFI в режиме загрузки: https://github.com/kmille36/TempStorage/blob/main/xiaomi-nabu.img?raw=true

- Обновите драйвера до последней версии: https://github.com/erdilS/Port-Windows-11-Xiaomi-Pad-5/blob/main/guide/driver-updating-selection.md

- В редакторе реестра смените значение параметра ```RoleSwitchMode``` с ```3``` на ```1```: ```Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\ACPI\QCOM0597\0\Device Parameters```. 

- Перезапустите Windows!

## Я отключил тестовый режим и теперь мой планшет не загружается в Windows

> [!IMPORTANT]
>  Посмотрите это [видео](https://youtu.be/oHg5SJYRHA0) перед тем, как пытаться что-либо сделать во избежание еще больших проблем

- Хорошенько гляньте на себя в зеркало

- Осознайте какое вы разочарование

- Следуйте тому, что написано ниже

- Загрузите Recovery через команду ```fastboot boot <recovery.img>```

- Загрузите Mass Storage-скрипт через команду ```adb push msc.sh /sbin/```

- Запустите Mass Storage-скрипт через команду  ```adb shell sh /sbin/msc.sh```

- Откройте Командную Строку от имени администратора

- Пропишите ```diskpart```, чтобы запустить DiskPart (Ничёсе)

- Найдите раздел ESP через команду ```list volume```, у одного из них должно быть название ESPNABU

- Выберите ESP-раздел, прописав ```select volume <number>```

- Присвойте ему букву, прописав ```assign letter=y```

- Выйдите из DiskPart, прописав ```exit```

- Пропишите эту команду, чтобы включить Тестовый Режим обратно ```bcdedit /store Y:\EFI\Microsoft\BOOT\BCD /set {default} testsigning on```

- Перезагрузите планшет в Bootloader, запустите ваш UEFI-образ, и теперь Windows должен запускаться
